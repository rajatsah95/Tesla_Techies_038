<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <style>
        * {
            margin: 0;
            padding: 0;
        }
        .con {
            max-width: 1450px;
            margin: auto;
        }
        .nav-bar-1 {
            max-width: 1050px;
            margin: auto;
            height: 75px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .nav1-left>a>img {
            height: 50px;
        }
        .right-button-dot {
            display: flex;
            align-items: center;
            gap: 20px;
            justify-content: space-evenly;
        }
        .add-data {
            max-width: 900px;
            margin: auto;
            display: flex;
            flex-direction: column;
        }
        .add-data>button {
            position: absolute;
            top: 23px;
            right: 325px;
            padding: 5px 10px;
            border-radius: 20px;
            background-color: green;
            border: none;
            color: white;
            opacity: 50%;
            cursor: pointer;
            width: max-content;
        }
        .add-data>.title-1 {
            margin: 50px 0 0 50px;
            font-size: 40px;
            border: none;
            outline: none;
        }
        .add-data>.story-1 {
            margin: 10px 0 0 50px;
            font-size: 30px;
            border: none;
            outline: none;
        }
        .add-data>.title-1:hover, .add-data>.story-1:hover {
            border-left: 1px solid gray;
        }
        input::placeholder {
            height: 50px;
            color: rgb(211, 211, 211);
        }
        .output {
            max-width: 900px;
            margin: 50px auto;
            padding: 20px;
            border: 1px solid #ccc;
            display: none;
        }
        .output h1 {
            font-size: 40px;
            margin-bottom: 20px;
        }
        .output p {
            font-size: 30px;
        }
    </style>
</head>
<body>
    <header>
        <div class="con">
            <nav class="nav-bar-1">
                <div class="nav1-left">
                    <a href="index.html" aria-label="logo"><img src="assets/newLogoInfoHub.png" alt=""></a>  
                </div>
                <div class="nav1-right">
                    <div class="right-button-dot">
                        <span>
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="gray">
                                <path d="M158.37-199.37v-86h72.13v-262.87q0-86.11 51.57-153.6 51.56-67.49 134.43-88.7v-24.09q0-26.25 18.49-44.63 18.48-18.37 44.89-18.37t45.02 18.37q18.6 18.38 18.6 44.63v24.09q83.11 21.21 134.55 88.58 51.45 67.37 51.45 153.72v262.87h72.13v86H158.37ZM480-498.8Zm.24 417.56q-33.68 0-57.28-23.52-23.59-23.52-23.59-57.11h161.5q0 33.7-23.52 57.16-23.53 23.47-57.11 23.47ZM316.5-285.37h327v-262.87q0-67.44-48.04-115.47t-115.5-48.03q-67.46 0-115.46 48.03t-48 115.47v262.87Z"/>
                            </svg>
                        </span>
                        <span>
                            <svg xmlns="http://www.w3.org/2000/svg" height="40px" viewBox="0 -960 960 960" width="40px" fill="#e8">
                                <path d="M232-253.08q59.92-38.46 118.92-58.96T480-332.54q70.08 0 129.38 20.5 59.31 20.5 119.23 58.96 43.62-50.53 64.81-106.69 21.19-56.15 21.19-120.23 0-141.54-96.53-238.08-96.54-96.53-238.08-96.53-141.54 0-238.08 96.53-96.53 96.54-96.53 238.08 0 64.08 21.5 120.23 21.5 56.16 65.11 106.69Zm247.81-204.23q-53.96 0-90.77-36.99-36.81-37-36.81-90.96 0-53.97 36.99-90.78 37-36.81 90.97-36.81 53.96 0 90.77 37 36.81 36.99 36.81 90.96 0 53.97-36.99 90.77-37 36.81-90.97 36.81ZM479.6-100q-78.92 0-148.4-29.77-69.47-29.77-120.87-81.58-51.41-51.8-80.87-120.8Q100-401.14 100-480.5q0-78.97 29.77-148.16t81.58-120.49q51.8-51.31 120.8-81.08Q401.14-860 480.5-860q78.97 0 148.16 29.77t120.49 81.08q51.31 51.3 81.08 120.65Q860-559.15 860-480.27q0 79.28-29.77 148.2-29.77 68.92-81.08 120.72-51.3 51.81-120.78 81.58Q558.9-100 479.6-100Z"/>
                            </svg>
                        </span>
                    </div>
                </div>
            </nav>
        </div>
    </header>
    <section>
        <div class="con">
            <div class="add-data-1">
                <form id="dataForm" class="add-data">
                    <input type="text" class="title-1" aria-label="text" placeholder="Title" required>
                    <input type="text" class="story-1" aria-label="text" placeholder="Tell your story..." required>
                    <button type="submit" class="publish-btn">Publish</button>
                </form>
            </div>
            <div class="output" id="output">
                <h1></h1>
                <p></p>
            </div>
        </div>
    </section>
</body>
</html>
<script>
     let savedArticlesApi = 'https://tesla-techies-038-2.onrender.com/savedArticles';
   let userId = localStorage.getItem("loggedUserId") 
  if(!userId){
    userId = 1;
  }
    //   const userId = 1; // Replace with actual user ID

let publishBtn = document.querySelector(".publish-btn");

publishBtn.addEventListener('click', (event) => {
    event.preventDefault();
    publish();
});

async function publish() {
    console.log("Publish Button Clicked");

    let form = document.querySelector("form"); // Assuming there is a form element in your HTML
    let title = form[0].value;
    console.log(title);
    let content = form[1].value;
    console.log(content);
    let uniqueID = Math.floor(Math.random() * 1000000000) + 10000000000;
    console.log(uniqueID);  
    let obj = {
        "title": title,
        "content": content,
        "id": uniqueID,
        "url": "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRmCy16nhIbV3pI1qLYHMJKwbH2458oiC9EmA&s"
    };

    try {
        let res = await fetch(`https://tesla-techies-038-2.onrender.com/savedArticles`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(obj)
        });

        if (!res.ok) throw new Error("Network response was not ok");

        console.log("Article added successfully");
        alert("Article Published Successfully. You can check in Stories Section");
        form.reset();
    } catch (error) {
        console.error("Error updating user data:", error);
    }

// /////add savedArticleId to writenArticles array//////////////////////////
// const userId = 'YOUR_USER_ID'; // Replace with the actual user ID
// const uniqueId = 'YOUR_UNIQUE_ID'; // Replace with the actual unique ID to add
const url = `https://tesla-techies-038-2.onrender.com/users/${userId}`;

// Fetch the current user data
fetch(url)
  .then(response => response.json())
  .then(user => {
    // Ensure writtenArticles exists and is an array
    if (!user.writtenArticles) {
      user.writtenArticles = [];
    }
    // Add the uniqueId to the writtenArticles array
    user.writtenArticles.push(uniqueId);

    // Send a PATCH request to update the user's data
    return fetch(url, {
      method: 'PATCH',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ writtenArticles: user.writtenArticles })
    });
  })
  .then(response => response.json())
  .then(data => console.log('Updated user data:', data))
  .catch(error => console.error('Error:', error));


       






// /////add savedArticleId to writenArticles array ending //////////////////////////

}

     
</script>